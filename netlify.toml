[build]
  command = "npm run build"
  publish = "dist"

[build.environment]
  NODE_VERSION = "20"

# API Functions - Netlify will automatically detect functions in netlify/functions
# Route API calls to Netlify Functions
[[redirects]]
  from = "/api/auth/register"
  to = "/.netlify/functions/auth-register"
  status = 200

[[redirects]]
  from = "/api/auth/login"
  to = "/.netlify/functions/auth-login"
  status = 200

[[redirects]]
  from = "/api/auth/reset-password"
  to = "/.netlify/functions/auth-reset-password"
  status = 200

[[redirects]]
  from = "/api/user/profile"
  to = "/.netlify/functions/user-profile"
  status = 200

[[redirects]]
  from = "/api/garmin/connect"
  to = "/.netlify/functions/garmin-connect"
  status = 200

[[redirects]]
  from = "/api/garmin/connect-mfa"
  to = "/.netlify/functions/garmin-connect-mfa"
  status = 200

[[redirects]]
  from = "/api/garmin/status"
  to = "/.netlify/functions/garmin-status"
  status = 200

[[redirects]]
  from = "/api/garmin/send-workout"
  to = "/.netlify/functions/garmin-send-workout"
  status = 200

[[redirects]]
  from = "/api/garmin/disconnect"
  to = "/.netlify/functions/garmin-disconnect"
  status = 200

# SPA fallback - all non-API routes go to index.html
[[redirects]]
  from = "/*"
  to = "/index.html"
  status = 200
